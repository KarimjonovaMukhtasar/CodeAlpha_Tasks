<!DOCTYPE html>
<html lang="en">

<%- include('../partials/head') %>
<link rel="stylesheet" href="/css/style.css">

<body>
  <%- include('../partials/navbar') %>

  <main class="container">

    <article class="card-main">

      <div class="post-header">
        <a href="/users/<%= post.author.username %>">@<%= post.author.username %></a>
        <span class="post-date"><%= new Date(post.created_at).toLocaleDateString() %></span>
      </div>

      <h1 class="post-title"><%= post.title %></h1>

      <p class="post-content"><%= post.content %></p>

      <div class="action-buttons">

        <form action="/posts/<%= post.id %>/like" method="POST">
          <button class="btn btn-like">‚ù§Ô∏è Like (<%= post.likes.length %>)</button>
        </form>

        <% if (currentUser && currentUser.id === post.author.id) { %>
          <a href="/posts/<%= post.id %>/edit" class="btn btn-edit">‚úèÔ∏è Edit</a>

          <form action="/posts/<%= post.id %>/delete" method="POST"
            onsubmit="return confirm('Are you sure you want to delete this post?');">
            <button class="btn btn-delete">üóë Delete</button>
          </form>
        <% } %>
    </div>
    </article>

    <h3 class="mt-4">Comments (<%= post.comments.length %>)</h3>

    <% if (currentUser) { %>
      <div class="card-main" style="padding: 15px;">
        <form action="/posts/<%= post.id %>/comments" method="POST">
          <textarea name="content" rows="2" placeholder="Write a comment..." required></textarea>
          <button type="submit" class="btn btn-primary btn-rounded mt-2">Post Comment</button>
        </form>
      </div>
    <% } %>

    <% post.comments.forEach(comment => { %>
      <div class="card-main" style="padding: 12px; margin-top: 10px;">
        <small class="comment-author">
          <strong><%= comment.author.username %></strong> says:
        </small>
        <p class="comment-content"><%= comment.content %></p>
      </div>
    <% }) %>
  </main>
  <%- include('../partials/footer') %>
</body>
</html>
